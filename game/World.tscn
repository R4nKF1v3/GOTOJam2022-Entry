[gd_scene load_steps=20 format=2]

[ext_resource path="res://game/World.gd" type="Script" id=1]
[ext_resource path="res://assets/fonts/en/regular_big.tres" type="DynamicFont" id=2]
[ext_resource path="res://game/scenarios/YoungScenario.tscn" type="PackedScene" id=3]
[ext_resource path="res://game/scenarios/OldScenario.tscn" type="PackedScene" id=4]
[ext_resource path="res://game/player/Player.tscn" type="PackedScene" id=5]
[ext_resource path="res://assets/fonts/en/regular_medium.tres" type="DynamicFont" id=6]
[ext_resource path="res://game/Tooltip.gd" type="Script" id=7]
[ext_resource path="res://assets/fonts/en/regular_small.tres" type="DynamicFont" id=8]
[ext_resource path="res://game/DialogueHandler.gd" type="Script" id=9]
[ext_resource path="res://utils/AudioHandler.tscn" type="PackedScene" id=10]
[ext_resource path="res://assets/sounds/sfx/typewriter_key.wav" type="AudioStream" id=11]
[ext_resource path="res://game/InspectManager.tscn" type="PackedScene" id=12]
[ext_resource path="res://game/Item.tscn" type="PackedScene" id=13]

[sub_resource type="Shader" id=2]
code = "shader_type canvas_item;

uniform float total_brightness = 0.8;
uniform float desaturation = 1.0;
uniform float gray_brightness = 1.0;
uniform float red_mult = 1.0;
uniform float blue_mult = 1.0;

void fragment()
{
	vec4 col = texture(SCREEN_TEXTURE, SCREEN_UV);
	col.rgb = mix(vec3(0.0), col.rgb, total_brightness);
	if(!AT_LIGHT_PASS){
		float median = (col.r + col.g + col.b) / 3.0 * gray_brightness;
		col = vec4(median * red_mult, median, median * blue_mult, col.a);
	}
	COLOR = col;
}

"

[sub_resource type="ShaderMaterial" id=3]
shader = SubResource( 2 )
shader_param/total_brightness = 0.8
shader_param/desaturation = 1.0
shader_param/gray_brightness = 0.8
shader_param/red_mult = 1.0
shader_param/blue_mult = 1.0

[sub_resource type="Gradient" id=5]
offsets = PoolRealArray( 0, 0.268482, 0.798, 1 )
colors = PoolColorArray( 0, 0, 0, 1, 0.160784, 0.160784, 0.160784, 1, 0.784314, 0.784314, 0.784314, 1, 1, 1, 1, 1 )

[sub_resource type="GradientTexture" id=6]
gradient = SubResource( 5 )

[sub_resource type="Environment" id=4]
background_mode = 4
adjustment_enabled = true
adjustment_color_correction = SubResource( 6 )

[sub_resource type="StyleBoxFlat" id=1]
bg_color = Color( 0, 0, 0, 0 )
shadow_color = Color( 0, 0, 0, 0.25098 )
shadow_size = 5

[node name="World" type="Node" groups=["event_synchronizer", "progress_listeners"]]
script = ExtResource( 1 )

[node name="BackgroundLayer" type="CanvasLayer" parent="."]
layer = -1

[node name="Background" type="ColorRect" parent="BackgroundLayer"]
anchor_right = 1.0
anchor_bottom = 1.0
mouse_filter = 2
color = Color( 0, 0, 0, 1 )

[node name="OldScenario" parent="." instance=ExtResource( 4 )]

[node name="YoungScenario" parent="." instance=ExtResource( 3 )]
position = Vector2( 0, 1080 )

[node name="Player" parent="." instance=ExtResource( 5 )]
position = Vector2( 826, 732 )
z_index = 1
z_as_relative = false
walk_speed = 200.0

[node name="Overlay" type="CanvasLayer" parent="."]
layer = 0

[node name="ScreenEffects" type="Control" parent="Overlay"]
anchor_right = 1.0
anchor_bottom = 1.0
mouse_filter = 2

[node name="PostProcessing" type="ColorRect" parent="Overlay/ScreenEffects"]
light_mask = 2
material = SubResource( 3 )
anchor_right = 1.0
anchor_bottom = 1.0
mouse_filter = 2

[node name="CanvasModulate" type="CanvasModulate" parent="Overlay/ScreenEffects"]
color = Color( 0.745098, 0.745098, 0.745098, 1 )

[node name="WorldEnvironment" type="WorldEnvironment" parent="Overlay/ScreenEffects"]
environment = SubResource( 4 )

[node name="HUD" type="Control" parent="Overlay"]
anchor_right = 1.0
anchor_bottom = 1.0
mouse_filter = 2

[node name="ChangeStateButton" type="Button" parent="Overlay/HUD"]
anchor_left = 0.5
anchor_right = 0.5
margin_left = 50.0
margin_right = 389.0
margin_bottom = 91.0
custom_fonts/font = ExtResource( 2 )
text = "Pills"

[node name="Items" type="HBoxContainer" parent="Overlay/HUD"]
anchor_left = 0.5
anchor_right = 0.5
margin_left = -237.0
margin_top = 4.0
margin_right = -50.0
margin_bottom = 87.0
grow_horizontal = 0
alignment = 2

[node name="Item" parent="Overlay/HUD/Items" instance=ExtResource( 13 )]
margin_left = 87.0
margin_right = 187.0

[node name="InspectManager" parent="Overlay/HUD" instance=ExtResource( 12 )]

[node name="Dialogue" type="Label" parent="Overlay/HUD" groups=["dialogue"]]
anchor_top = 1.0
anchor_right = 1.0
anchor_bottom = 1.0
margin_left = 130.0
margin_top = -71.0
margin_right = -130.0
margin_bottom = -23.0
grow_horizontal = 2
grow_vertical = 0
custom_fonts/font = ExtResource( 6 )
text = "lorem ipsum"
align = 1
valign = 1
autowrap = true
script = ExtResource( 9 )

[node name="FadeTween" type="Tween" parent="Overlay/HUD/Dialogue"]

[node name="TextTimer" type="Timer" parent="Overlay/HUD/Dialogue"]

[node name="DelayTimer" type="Timer" parent="Overlay/HUD/Dialogue"]
wait_time = 3.0
one_shot = true

[node name="TextSFX" parent="Overlay/HUD/Dialogue" instance=ExtResource( 10 )]
_audio_references = [ ExtResource( 11 ) ]
_db_volumes = [ 0.0 ]
_pitch_scales = [ [ 0.9, 1.1 ] ]

[node name="TooltipPos" type="Position2D" parent="Overlay" groups=["tooltip"]]
script = ExtResource( 7 )

[node name="Tooltip" type="Label" parent="Overlay/TooltipPos"]
margin_left = -24.0
margin_top = 45.0
margin_right = 26.0
margin_bottom = 69.0
grow_horizontal = 2
grow_vertical = 2
custom_fonts/font = ExtResource( 8 )
text = "lorem"

[node name="Panel" type="Panel" parent="Overlay/TooltipPos/Tooltip"]
show_behind_parent = true
anchor_right = 1.0
anchor_bottom = 1.0
mouse_filter = 2
custom_styles/panel = SubResource( 1 )

[node name="FadeTween" type="Tween" parent="Overlay/TooltipPos"]

[connection signal="changed_target" from="Player" to="." method="_on_Player_changed_target"]
[connection signal="stopped_moving" from="Player" to="." method="_on_Player_stopped_moving"]
[connection signal="button_up" from="Overlay/HUD/ChangeStateButton" to="." method="_on_ChangeStateButton_button_up"]
[connection signal="timeout" from="Overlay/HUD/Dialogue/TextTimer" to="Overlay/HUD/Dialogue" method="_on_TextTimer_timeout"]
[connection signal="timeout" from="Overlay/HUD/Dialogue/DelayTimer" to="Overlay/HUD/Dialogue" method="_on_DelayTimer_timeout"]
